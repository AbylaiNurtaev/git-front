# Backend: имя игрока в ленте выигрышей (/club/qr)

На странице клуба [QR](https://git-front-sandy.vercel.app/club/qr) внизу показывается лента в формате **«Имя выиграл Приз»**. Сейчас бэкенд отдаёт только телефон — из‑за этого показывается «+7 771 *** 3738 выиграл Fanta». Нужно отдавать **имя пользователя**, чтобы было «Абылай выиграл Fanta».

---

## Что именно поменять на бэкенде

### 1. Эндпоинт: **POST /api/players/spin** (или ваш путь спина)

**Что сделать:** при сохранении выигрыша передавать в хранилище/ленту не только телефон, но и **имя игрока**.

- У вас уже есть объект игрока/пользователя (из сессии, JWT, БД) — возьмите оттуда поле **имя** (например `user.name`, `user.fio`, `player.name`).
- При добавлении записи в «последние выигрыши» сохраняйте это имя рядом с телефоном и призом (см. п. 2 и 3).
- При эмите в сокет (см. п. 2) в payload и в каждом элементе `recentWins` передавайте поле **`playerName`** или **`name`** с этим значением.

Итого: в коде спина, после определения выигранного приза и данных игрока, передавайте имя в функцию добавления выигрыша и в объект, который уходит в сокет.

---

### 2. Событие **Socket.IO: `spin`**

**Где:** код, который делает `io.to(room).emit('spin', payload)` после спина.

**Что добавить в payload:**

- **`playerName`** или **`name`** — строка с именем выигравшего (ФИО или ник). Пример: `"Абылай"`.
- В массиве **`recentWins`** в **каждом** элементе должны быть поля **`playerName`** или **`name`** (плюс уже есть `prizeName`; `maskedPhone` можно оставить как запасной вариант).

Пример payload, при котором на фронте будет «Имя выиграл Приз»:

```json
{
  "playerName": "Абылай",
  "playerPhone": "+77001234567",
  "recentWins": [
    { "playerName": "Абылай", "prizeName": "Fanta" },
    { "playerName": "Мария", "prizeName": "20 баллов" }
  ],
  "spin": { "prize": { ... } }
}
```

Фронт выводит строку вида **«{имя} выиграл {приз}»**, подставляя `playerName`/`name` из payload и из каждого элемента `recentWins`. Если `playerName`/`name` нет — показывается телефон или «Гость».

---

### 3. Хранение последних выигрышей (recentWins)

**Где:** функция/сервис, которая добавляет запись о выигрыше и возвращает список последних N выигрышей (например `addWin(clubId, playerPhone, prizeName)`).

**Что сделать:**

- Добавить параметр **имя игрока** (например `playerName`) и сохранять его в каждой записи.
- При возврате списка (для сокета и, при наличии, для GET API) в каждом элементе отдавать поле **`playerName`** или **`name`** с сохранённым именем.

Пример формата одного элемента в `recentWins`:

```json
{
  "playerName": "Абылай",
  "prizeName": "Fanta",
  "maskedPhone": "+7 771 *** 3738"
}
```

Достаточно одного из полей: **`playerName`** или **`name`**. Фронт приоритет отдаёт имени, потом уже телефону.

---

### 4. GET /players/recent-wins (если используется)

**Что сделать:** в каждом объекте массива в ответе отдавать **`name`** или **`playerName`** — имя игрока. Остальное (например `maskedPhone`, `prizeName`) можно оставить как есть.

Приоритет на фронте: **name** → **playerName** → **maskedPhone** → «Гость».

---

## Кратко

| Место | Что поменять |
|-------|----------------|
| **POST /api/players/spin** | Берёте имя игрока из user/player, передаёте его в функцию добавления выигрыша и в payload сокета. |
| **emit('spin', payload)** | В payload добавить `playerName`/`name`; в каждом элементе `recentWins` добавить `playerName`/`name`. |
| **addWin / getRecentWins** | Хранить и возвращать имя (например `playerName`) в каждой записи. |
| **GET /players/recent-wins** | В каждом элементе массива отдавать `name` или `playerName`. |
